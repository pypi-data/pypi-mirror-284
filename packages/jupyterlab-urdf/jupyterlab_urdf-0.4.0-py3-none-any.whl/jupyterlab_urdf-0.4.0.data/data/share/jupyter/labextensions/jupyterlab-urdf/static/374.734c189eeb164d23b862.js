"use strict";(self.webpackChunkjupyterlab_urdf=self.webpackChunkjupyterlab_urdf||[]).push([[374],{374:(e,t,o)=>{o.r(t),o.d(t,{IURDFTracker:()=>M,default:()=>j});var s=o(132),r=o(72),n=o(293),i=o(431),a=o(113),d=o(882),h=o(930),l=o(966),c=o(901),_=o(673),u=o(894);class p extends u.GUI{constructor(){super({autoPlace:!1}),this._workingPath="",this.controls={path:{},scene:{background:{},grid:{},height:{}},joints:{}},this.width=310,this.domElement.style.position="absolute",this.domElement.style.top="0",this.domElement.style.right="5px",this.domElement.setAttribute("class","dg main urdf-gui"),this._workspaceFolder=this.addFolder("Workspace"),this._workspaceFolder.domElement.setAttribute("class","dg workspace-folder"),this._sceneFolder=this.addFolder("Scene"),this._sceneFolder.domElement.setAttribute("class","dg scene-folder"),this._jointsFolder=this.addFolder("Joints"),this._jointsFolder.domElement.setAttribute("class","dg joints-folder")}get workspaceFolder(){return this._workspaceFolder}get sceneFolder(){return this._sceneFolder}get jointsFolder(){return this._jointsFolder}_isEmpty(e){return 0===Object.keys(e).length}createWorkspaceControls(e=""){if(this._isEmpty(this.controls.path)){this._workingPath=e;const t={Path:this._workingPath,"set path":()=>{console.debug("set path")}};this._workspaceFolder.add(t,"Path"),this.controls.path=this._workspaceFolder.add(t,"set path"),this._workspaceFolder.open()}return this.controls.path}createSceneControls(e=new _.Color(2503224),t=new _.Color(2503224)){if(this._isEmpty(this.controls.scene.background)){const o={Background:this._convertColor2Array(e),Grid:this._convertColor2Array(t),Height:0};this.controls.scene.background=this._sceneFolder.addColor(o,"Background"),this.controls.scene.grid=this._sceneFolder.addColor(o,"Grid");const s=-2,r=5,n=.1;this.controls.scene.height=this._sceneFolder.add(o,"Height",s,r,n),this._sceneFolder.open()}return this.controls.scene}_convertColor2Array(e){const t=e.getHexString();return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}createJointControls(e){return this._isEmpty(this.controls.joints)&&(Object.keys(e).forEach((t=>{if("fixed"===e[t].jointType)return;const o=Number(e[t].limit.lower),s=Number(e[t].limit.upper);if(0===o&&0===s)return;const r=(s-o)/20,n=e[t].jointValue[0];this.controls.joints[t]=this._jointsFolder.add({[t]:n},t,o,s,r)})),this._jointsFolder.open()),this.controls.joints}}var g=o(886);class m extends _.WebGLRenderer{constructor(e=new _.Color(2503224),t=new _.Color(2503224)){super({antialias:!0}),this._colorSky=new _.Color,this._colorGround=new _.Color,this._gridHeight=0,this._robotIndex=-1,this._colorSky=e,this._colorGround=t,this.setClearColor(16777215),this.setClearAlpha(0),this.outputColorSpace=_.SRGBColorSpace,this.shadowMap.enabled=!0,this.shadowMap.type=_.PCFSoftShadowMap,this._scene=new _.Scene,this._initScene(),this._camera=new _.PerspectiveCamera,this._initCamera(),this._controls=new g.z(this._camera,this.domElement),this._initControls()}_initCamera(){this._camera.position.set(4,4,4),this._camera.lookAt(0,0,0)}_initControls(){this._controls.rotateSpeed=2,this._controls.zoomSpeed=5,this._controls.panSpeed=2,this._controls.enableZoom=!0,this._controls.enableDamping=!1,this._controls.maxDistance=50,this._controls.minDistance=.25,this._controls.addEventListener("change",(()=>this.redraw()))}_initScene(){this._scene.background=this._colorSky,this._scene.up=new _.Vector3(0,0,1),this._addGround(),this._addGrid(),this._addLights()}_addGround(){const e=new _.Mesh(new _.PlaneGeometry(40,40),new _.ShadowMaterial({opacity:.5}));e.rotation.x=-Math.PI/2,e.scale.setScalar(30),e.receiveShadow=!0,this._scene.add(e)}_addGrid(){const e=new _.GridHelper(50,50,this._colorGround,this._colorGround);e.receiveShadow=!0,this._scene.add(e)}_addLights(){const e=new _.DirectionalLight(16777215,1);e.castShadow=!0,e.position.set(3,10,3),e.shadow.camera.top=2,e.shadow.camera.bottom=-2,e.shadow.camera.left=-2,e.shadow.camera.right=2,e.shadow.camera.near=.1,e.shadow.camera.far=40,this._scene.add(e);const t=new _.AmbientLight("#fff");t.intensity=.5,t.position.set(0,5,0),this._scene.add(t);const o=new _.HemisphereLight(this._colorSky,this._colorGround);o.intensity=1,this._scene.add(o)}_updateLights(){const e=new _.HemisphereLight(this._colorSky,this._colorGround);e.intensity=1;const t=this._scene.children.map((e=>e.type)).indexOf("HemisphereLight");this._scene.children[t]=e}setSkyColor(e){this._colorSky=new _.Color(...e.map((e=>e/255))),this._scene.background=this._colorSky,this._updateLights(),this.redraw()}setGroundColor(e){this._colorGround=new _.Color(...e.map((e=>e/255)));const t=this._scene.children.map((e=>e.type)).indexOf("GridHelper");this._scene.children[t]=new _.GridHelper(50,50,this._colorGround,this._colorGround),this._updateLights(),this.setGridHeight(this._gridHeight),this.redraw()}setGridHeight(e=0){const t=this._scene.children.map((e=>e.type)).indexOf("GridHelper");this._scene.children[t].position.y=e,this._gridHeight=e,this.redraw()}setRobot(e){this._robotIndex<0?(this._scene.add(e),this._robotIndex=this._scene.children.map((e=>e.name)).indexOf(e.name)):this._scene.children[this._robotIndex]=e,this.redraw()}redraw(){const e=this.getSize(new _.Vector2);this._camera.aspect=e.width/e.height,this._camera.updateProjectionMatrix(),this.render(this._scene,this._camera)}}var w=o(218),C=o.n(w),y=o(870),f=o(660);class b extends y.XacroLoader{constructor(){super(),this.workingPath=""}}class x extends _.LoadingManager{constructor(){super(),this._workingPath="",this._robotString="",this._robotModel={},this._isReady=!1,this._urdfLoader=new(C())(this),this._xacroLoader=new b,this.setWorkingPath()}setWorkingPath(e=""){e="/"===(e="/"!==e[0]?"/"+e:e)[e.length-1]?e.slice(0,-1):e,console.debug("[Manager]: Modify URL with prefix ",e),this._workingPath=e,this.setURLModifier((e=>{if(e.startsWith(this._workingPath))return console.debug("[Loader]:",e),"/files"+e;{const t="/files"+this._workingPath+e;return console.debug("[Loader]:",t),t}})),this._xacroLoader.workingPath=f.PageConfig.getBaseUrl()+"files"+this._workingPath,console.debug("[Xacro]: Modify URL with prefix",this._xacroLoader.workingPath)}setRobot(e=""){this._robotString=e||this._robotString,e.includes("xacro")?this._xacroLoader.parse(this._robotString,(e=>{this._robotModel=this._urdfLoader.parse(e),this._robotModel.rotation.x=-Math.PI/2}),(e=>console.error(e))):(this._robotModel=this._urdfLoader.parse(this._robotString),this._robotModel.rotation.x=-Math.PI/2)}dispose(){this._robotModel={}}get robotModel(){return this._robotModel}get workingPath(){return this._workingPath}get isReady(){return this._isReady=!(0===Object.keys(this._robotModel).length),this._isReady}}class k extends d.PanelLayout{constructor(){super(),this._host=document.createElement("div"),this._colors={sky:this._getThemeColor("--jp-layout-color1")||new _.Color(2503224),ground:this._getThemeColor("--jp-layout-color2")||new _.Color(2503224)},this._renderer=new m(this._colors.sky,this._colors.ground),this._controlsPanel=new p,this._loader=new x}dispose(){this._renderer.dispose(),this._loader.dispose(),super.dispose()}init(){super.init(),this.addWidget(new d.Widget({node:this._host}))}iter(){return[][Symbol.iterator]()}removeWidget(e){}updateURDF(e){this._loader.setRobot(e),this._renderer.setRobot(this._loader.robotModel)}setURDF(e){const t=e.path,o=t.substring(0,t.lastIndexOf("/"));this._loader.setWorkingPath(o),this._loader.onLoad=()=>{this._renderer.setRobot(this._loader.robotModel),this._setControls()},this._loader.setRobot(e.model.toString()),this._loader.isReady&&(this._renderer.setRobot(this._loader.robotModel),this._setControls())}_getThemeColor(e){const t=window.getComputedStyle(document.documentElement).getPropertyValue(e);return this._parseColor(t)}_parseColor(e){let t;if("#"!==e[0])t=new _.Color(e);else if(4===e.length){const o=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];t=new _.Color(Number("0x"+o))}else 7===e.length&&(t=new _.Color(Number("0x"+e.substring(1))));return t}_setControls(){this._loader.isReady&&(this._setPathControls(),this._setSceneControls(),this._setJointControls())}_setPathControls(){const e=this._controlsPanel.createWorkspaceControls(this._loader.workingPath);e.onChange(((t=e.object.Path)=>{this._loader.setWorkingPath(t),this.updateURDF("")}))}_setSceneControls(){const e=this._controlsPanel.createSceneControls(this._colors.sky,this._colors.ground);e.background.onChange((e=>this._renderer.setSkyColor(e))),e.grid.onChange((e=>this._renderer.setGroundColor(e))),e.height.onChange((e=>this._renderer.setGridHeight(e)))}_setJointControls(){const e=this._controlsPanel.createJointControls(this._loader.robotModel.joints);Object.keys(e).forEach((t=>{e[t].onChange(((e=0)=>{this._setJointValue(t,e)}))}))}_setJointValue(e,t){this._loader.robotModel.setJointValue(e,t),this._renderer.setRobot(this._loader.robotModel)}onUpdateRequest(e){this._resizeWorkspace()}onResize(e){this._resizeWorkspace()}onFitRequest(e){this._resizeWorkspace()}onAfterAttach(e){this._renderer.redraw(),this._host.appendChild(this._renderer.domElement),this._renderer.setSize(this._renderer.domElement.clientWidth,this._renderer.domElement.clientHeight),this._host.appendChild(this._controlsPanel.domElement)}_resizeWorkspace(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.node.getBoundingClientRect();this._host.style.height=(null==t?void 0:t.height)+"px";const o=this._renderer.getSize(new _.Vector2);this._renderer.setSize((null==t?void 0:t.width)||o.width,(null==t?void 0:t.height)||o.height),this._renderer.redraw()}}class F extends l.DocumentWidget{constructor(e){super(e)}dispose(){this.content.dispose(),super.dispose()}}class L extends d.Panel{constructor(e){super({layout:new k}),this.addClass("jp-urdf-canvas"),this._context=e,this._context.model.toString()||this._context.model.fromString('<?xml version="1.0"?> \n <robot name="robot"> \n     <link name="sphere"> \n         <visual> \n             <geometry> \n                 <sphere radius="0.5"/> \n             </geometry> \n             <origin rpy="0 0 0" xyz="0 0 0.5"/> \n         </visual> \n     </link> \n </robot>'),this._context.ready.then((e=>{this.layout.setURDF(this._context),this._context.model.contentChanged.connect(((e,t)=>{this.layout.updateURDF(this._context.model.toString())}))}))}dispose(){this.isDisposed||(c.Signal.clearData(this),super.dispose())}onAfterAttach(e){super.onAfterAttach(e)}onBeforeDetach(e){super.onBeforeDetach(e)}}class S extends l.ABCWidgetFactory{constructor(e){super(e)}createNewWidget(e){return new F({context:e,content:new L(e)})}}const R=new(o(45).LabIcon)({name:"urdf:icon/logo",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100.01231721885031mm" height="100.01231721885031mm" viewBox="0 0 283.4994818802056 283.4994818802056">\nUntitled Project - Component A\n<g>\n  <g>\n    <path d="M1.762417076225006 119.57792699739295 C13.999374311492135 42.31681971821132 86.66044760363104 -10.474540159042103 163.92155488281267 1.7624170762250202 C241.1826621619943 13.999374311492144 293.97402203924776 86.66044760363104 281.7370648039806 163.92155488281267 C269.5001075687135 241.1826621619943 196.8390342765746 293.97402203924776 119.57792699739298 281.7370648039806 C42.31681971821135 269.5001075687135 -10.474540159042123 196.83903427657458 1.762417076225006 119.57792699739295 Z " fill="#212738" fill-rule="evenodd" stroke="none" />\n  </g>\n  <path d="M280.87066039774925 114.53322713167393 C273.7275466532088 78.11180980523483 252.44341742784587 45.918343258267555 222.14166466155956 25.004575481177554 L151.22537955973655 159.87708379301245 L110.5215873631774 95.0167789079892 L79.45049966863385 108.1764765833187 L111.13472395505119 216.22070817833554 L180.70994239603067 228.8508548357236 L280.87066039774925 114.53322713167393 Z " fill="#16E0BD" fill-rule="evenodd" stroke="none" />\n  <g>\n    <path d="M102.16979758737523 194.86077756661888 C106.19575651777811 169.44187327176812 130.1012496308918 152.07351587215175 155.52015392574256 156.09947480255462 C180.93905822059332 160.1254337329575 198.3074156202097 184.0309268460712 194.28145668980682 209.44983114092196 C190.25549775940394 234.86873543577272 166.35000464629024 252.2370928353891 140.93110035143948 248.2111339049862 C115.51219605658872 244.18517497458333 98.14383865697235 220.27968186146964 102.16979758737523 194.86077756661888 Z " fill="#98CE00" fill-rule="evenodd" stroke="none" />\n  </g>\n  <path d="M49.24638928163999 111.48587339397213 C51.7814744252104 117.43357890603858 56.575446076117174 122.13062310634766 62.57368502754022 124.54370972415656 C68.57192397896327 126.95679634196546 75.28308564329218 126.88825785207258 81.23079082876912 124.35317194227233 L81.23079082876912 124.35317194227233 L121.11919669584708 107.35156669712015 C127.06690163130301 104.81648089388615 131.76394507975917 100.02250892916653 134.17703101637392 94.0242699966533 C136.59011695298867 88.02603106414007 136.5215779254771 81.31486970734716 133.9864917387289 75.36716493535621 L122.77678604429826 49.06745946581526 C120.28330947005776 43.217377288340586 113.51951908268094 40.496310340702884 107.66943650730087 42.9897859813955 C104.86012721479717 44.18719545344459 102.64154904116945 46.45155601234338 101.50176394154622 49.28473409911756 C100.36197884192298 52.11791218589173 100.39435209408022 55.28782856108819 101.59176195088747 58.09713768959672 L101.59176195088747 58.09713768959672 L104.07563545325476 63.924689938804676 L104.07563545325476 63.92468993880466 C105.93180935933728 68.27956163859253 105.98199313235024 73.1934313514159 104.21514691466717 77.58530379199222 C102.4483006969841 81.97717623256854 99.00915533653696 85.48729206475865 94.65428358297416 87.34346584467679 L85.12436245041557 91.40539710969534 C80.76949060807269 93.26157092745414 75.85562077417019 93.31175445934332 71.46374836714192 91.54490789969307 C67.07187596011364 89.77806134004283 63.56176035275145 86.33891558064815 61.70558701556834 81.98404353346987 L59.221714908583465 76.15649230709042 C58.02430554323073 73.34718324648425 55.75994526747406 71.12860519044001 52.92676749682498 69.98881998868563 C50.0935897261759 68.84903478693126 46.92367363215665 68.88140770869796 44.11436457438373 70.07881708069795 L44.11436457438373 70.07881708069795 C38.26428145283922 72.57229295418176 35.543213544609124 79.3360838412765 38.036689220768096 85.18616704692661 L38.036689220768096 85.18616704692664 L49.24638928163999 111.48587339397213 Z " fill="#98CE00" fill-rule="evenodd" stroke="none" />\n</g>\n</svg>\n\x3c!--\nGenerator: Cuttle.xyz\n--\x3e'});var v=o(776);const P="URDF Widget Factory",M=new h.Token("urdf-tracker"),j={id:"jupyterlab-urdf:extension",autoStart:!0,requires:[r.ICommandPalette,s.ILayoutRestorer,a.IDefaultFileBrowser,i.IMainMenu,n.ILauncher,v.IEditorLanguageRegistry],activate:(e,t,o,s,n,i,a)=>{var h,l,c,_;console.log("JupyterLab extension URDF is activated!");const{commands:u}=e,p=new r.WidgetTracker({namespace:"jupyterlab-urdf"});o&&o.restore(p,{command:"docmanager:open",args:e=>({path:e.context.path,factory:P}),name:e=>(console.debug("[Restorer]: Re-opening",e.context.path),e.context.path)});const g=new S({name:P,fileTypes:["urdf"],defaultFor:["urdf"]});if(g.widgetCreated.connect(((e,t)=>{t.title.icon=R,t.title.iconClass="jp-URDFIcon",t.context.pathChanged.connect((()=>{p.save(t)})),p.add(t)})),e.docRegistry.addWidgetFactory(g),e.docRegistry.addFileType({name:"urdf",displayName:"URDF",extensions:[".urdf",".xacro"],iconClass:"jp-URDFIcon",fileFormat:"text",contentType:"file",mimeTypes:["application/xml","text/xml"],icon:R}),u.addCommand("urdf:create-new",{label:"Create new URDF",icon:R,iconClass:"jp-URDFIcon",caption:"Create a new URDF",execute:()=>{const e=s.model.path;u.execute("docmanager:new-untitled",{path:e,type:"file",ext:".urdf"}).then((e=>u.execute("docmanager:open",{path:e.path,factory:P})))}}),i&&i.add({command:"urdf:create-new",category:"Other",rank:20}),n){const e=new d.Menu({commands:u});e.title.label="URDF",e.addItem({command:"urdf:create-new"}),n.addMenu(e)}t&&t.addItem({command:"urdf:create-new",category:"URDF"}),a&&(null===(l=null===(h=a.findByMIME("text/xml"))||void 0===h?void 0:h.extensions)||void 0===l||l.push("urdf"),null===(_=null===(c=a.findByMIME("text/xml"))||void 0===c?void 0:c.extensions)||void 0===_||_.push("xacro"))}}}}]);