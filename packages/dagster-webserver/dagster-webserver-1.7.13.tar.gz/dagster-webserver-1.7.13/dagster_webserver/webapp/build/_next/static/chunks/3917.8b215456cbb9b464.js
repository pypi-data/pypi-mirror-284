"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3917],{3917:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return eq},default:function(){return eP}});var i=t(73235),o=t(52322),r=t(40794),s=t(89130),l=t(14934),a=t(74580),u=t(35292),c=t(74188),d=t(43212),p=t(37483),x=t(2784),m=t(7267),h=t(40250),g=t(43111),j=t(35002),y=t(38491),f=t(46806),v=t(89776),S=t(39013),w=t(35505),b=t(98904),C=t(79115),I=t(22351),N=t(38533),R=t(17650),T=t(83846),O=t(51154),k=t(68300),E=t(878),_=t(6484),L=t(8068),A=t(98832),F=t(23399),K=t(44900),z=t(13549),D=t(51701),V=t(88257),U=t(20171);let J=e=>{(0,x.useEffect)(()=>{let n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(!n)return;let t=n.getAttribute("href");return n.setAttribute("href",e),()=>{t&&n.setAttribute("href",t)}},[e])};var q=t(4378),P=t(38630),Q=t(34219);let M=e=>{switch(e){case V.VOA.FAILURE:return"/favicon-run-failed.svg";case V.VOA.SUCCESS:return"/favicon-run-success.svg";case V.VOA.STARTING:case V.VOA.STARTED:case V.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},H=(0,x.memo)(e=>{let{run:n,runId:t,trace:i}=e,[r,s]=(0,_.Bz)(),[l,a]=(0,q.q)({queryKey:"selection",defaults:{selection:""}});J(n?M(n.status):"/favicon.svg"),(0,U.j)(n?"".concat((0,K.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));let u=(e,n)=>{let t=n.find(n=>"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e);t&&(0,L._K)({body:(0,o.jsx)(F.T9,{error:t})})},c=e=>{a(e),s({...r,logQuery:"*"!==e?[{token:"query",value:e}]:[]})},d=(0,Q.FE)("RunLogs");return(0,o.jsx)(O.A.Provider,{value:n,children:(0,o.jsx)(I.C,{runId:t,children:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(B,{trace:i,dependency:d}),(0,o.jsx)(k.jp,{logs:e,children:i=>(0,o.jsx)(Z,{run:n,runId:t,logs:e,logsFilter:r,metadata:i,selectionQuery:l,onSetLogsFilter:s,onSetSelectionQuery:c,onShowStateDetails:u})})]})},t)})}),B=e=>{let{trace:n,dependency:t}=e;return x.useLayoutEffect(()=>{n.onLogsLoaded(),t.completeDependency(Q.Os.SUCCESS)},[t,n]),null},W=e=>{switch(e){case"stdout":return R.hi.stdout;case"stderr":return R.hi.stderr;default:return R.hi.structured}},Z=e=>{let{run:n,runId:t,logs:i,logsFilter:r,metadata:s,selectionQuery:a,onSetLogsFilter:u,onSetSelectionQuery:c}=e,[d,m]=(0,q.q)({queryKey:"logType",defaults:{logType:R.hi.structured}}),h=W(d),[S,w]=x.useState(null),I=JSON.stringify(Object.keys(s.steps).sort()),O=x.useMemo(()=>JSON.parse(I),[I]),k=(null==n?void 0:n.executionPlan)&&(0,D.J)(null==n?void 0:n.executionPlan,s.steps),_=x.useMemo(()=>k&&a&&"*"!==a?(0,A.V)(k,a).all.map(e=>e.name):[],[k,a]),L=(0,P.a)(),{logCaptureInfo:F,computeLogFileKey:K,setComputeLogFileKey:V}=(0,E.r)({stepKeys:O,selectionStepKeys:_,metadata:s,defaultToFirstStep:!1}),U=k?r.logQuery.filter(e=>e.token&&"query"===e.token).reduce((e,n)=>(e.push(...(0,A.V)(k,n.value).all.map(e=>e.name)),e),[]):[],[J,Q]=x.useState(null),M=x.useRef(null);x.useEffect(()=>{if(M.current){let e=M.current.getSize();100===e?Q("top"):0===e&&Q("bottom")}},[]);let H="top"===J,B="bottom"===J,Z=()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(50),Q(null)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(v.O,{ref:M,axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,o.jsx)(z.Fu,{run:n}):n.executionPlan&&k?(0,o.jsx)(g.S,{region:"gantt chart",children:(0,o.jsx)(z.hj,{options:{mode:z.hS.WATERFALL_TIMED},toolbarActions:(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,o.jsx)(j.u,{content:H?"Collapse":"Expand",children:(0,o.jsx)(y.zx,{icon:(0,o.jsx)(f.JO,{name:H?"collapse_arrows":"expand_arrows"}),onClick:H?Z:()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(100),Q("top")}})}),(0,o.jsx)(T.NX,{run:n,graph:k,metadata:s,selection:{query:a,keys:_}})]}),runId:t,graph:k,metadata:s,selection:{query:a,keys:_},onClickStep:(e,n)=>{let t;let i=_.indexOf(e),o='"'.concat(e,'"');if(n.shiftKey)t=[..._.map(e=>a.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e)],-1!==i?t.splice(i,1):t.push(o);else if(1===_.length&&-1!==i)t=[];else{t=[o];let n=(0,E.c)(s.logCaptureSteps,e);n&&V(n)}c(t.join(", ")||"*")},onSetSelection:c,focusedTime:r.focusedTime})}):(0,o.jsx)(p.t,{icon:"error",title:"Unable to build execution plan"}):(0,o.jsx)(z.ZW,{runId:t}),secondMinSize:56,second:(0,o.jsx)(g.S,{region:"logs",children:(0,o.jsxs)($,{children:[(0,o.jsx)(R.KZ,{logType:h,onSetLogType:e=>m(R.hi[e]),filter:r,onSetFilter:u,steps:O,metadata:s,computeLogFileKey:K,onSetComputeLogKey:V,computeLogUrl:S,counts:i.counts,isSectionExpanded:B,toggleExpanded:B?Z:()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(0),Q("bottom")}}),h!==R.hi.structured?K?L?(0,o.jsx)(b.h,{logKey:K?[t,"compute_logs",K]:[],logCaptureInfo:F,visibleIOType:R.hi[h],onSetDownloadUrl:w}):(0,o.jsx)(C.K,{runId:t,computeLogFileKey:O.length?K:void 0,ioType:R.hi[h],setComputeLogUrl:w}):(0,o.jsx)(G,{type:h}):(0,o.jsx)(N.S,{logs:i,filter:r,filterStepKeys:U,filterKey:"".concat(JSON.stringify(r)),metadata:s})]})})})})},$=w.ZP.div.withConfig({componentId:"sc-b0a44a9a-0"})(["display:flex;flex-direction:column;height:100%;"]),G=e=>{let{type:n}=e;return(0,o.jsx)(l.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:S.v8()},children:(0,o.jsx)(p.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})};function Y(){let e=(0,i._)(["\n  query RunAssetsQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        assets {\n          id\n          key {\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return Y=function(){return e},e}let X=e=>{let{run:n}=e,t=(0,K.pv)(n.pipelineName),i=(0,r.a)(ee,{variables:{runId:n.id},skip:t,fetchPolicy:"no-cache"}),{data:s,loading:l}=i;return((0,Q.Hu)(i,"RunAssetsQuery",{skip:t}),l||!s||"Run"!==s.pipelineRunOrError.__typename)?null:(0,o.jsx)(h.h,{useTags:!0,assetKeys:s.pipelineRunOrError.assets.map(e=>e.key)})},ee=(0,s.Ps)(Y());var en=t(45948),et=t(33379),ei=t(34147),eo=t(55010),er=t(60603),es=t(23808),el=t(23119),ea=t(74824),eu=t(59351),ec=t(43984),ed=t(33182),ep=t(96569),ex=t(4128),em=t(50309),eh=t(65297),eg=t(85227),ej=t(6023),ey=t(88610),ef=t(10539);let ev=e=>{var n,t;let{run:i,isJob:r}=e,{runConfigYaml:s}=i,l=i.tags.some(e=>e.key===ec.H.RunMetrics),[a,u]=(0,x.useState)(null),{rootServerURI:c}=(0,x.useContext)(ex.I),{refetch:d}=(0,x.useContext)(ed.Lw),{RunMetricsDialog:p}=(0,x.useContext)(eh.o),h=(0,eg.m)(),g=(0,m.k6)(),[v]=(0,et.D)(ej.FREE_CONCURRENCY_SLOTS_MUTATION),S=async()=>{h(s),await (0,em.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Copied!"})},w=async()=>{var e;(null===(e=(await v({variables:{runId:i.id}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&await (0,em.B7)({intent:"success",icon:"check_circle",message:"Freed concurrency slots"})},b=(0,ef.$y)({repositoryName:null===(n=i.repositoryOrigin)||void 0===n?void 0:n.repositoryName,repositoryLocationName:null===(t=i.repositoryOrigin)||void 0===t?void 0:t.repositoryLocationName,run:i,isJob:r});return(0,o.jsxs)("div",{children:[(0,o.jsxs)(ei.Z,{direction:"row",spacing:8,children:[b.disabledReason?(0,o.jsx)(j.u,{content:b.disabledReason,useDisabledButtonTooltipFix:!0,children:(0,o.jsx)(y.zx,{icon:(0,o.jsx)(f.JO,{name:b.icon}),disabled:!0,children:b.label})}):(0,o.jsx)(ey.A,{icon:(0,o.jsx)(f.JO,{name:b.icon}),to:b.to,children:b.label}),(0,o.jsx)(y.zx,{icon:(0,o.jsx)(f.JO,{name:"tag"}),onClick:()=>u("config"),children:"View tags and config"}),(0,o.jsx)(eo.J,{position:"bottom-right",content:(0,o.jsxs)(er.v2,{children:[(0,o.jsx)(j.u,{content:"Loadable in dagster-webserver-debug",position:"left",targetTagName:"div",children:(0,o.jsx)(er.sN,{text:"Download debug file",icon:"download_for_offline",onClick:()=>window.open("".concat(c,"/download_debug/").concat(i.id))})}),i.status===V.VOA.QUEUED?(0,o.jsx)(er.sN,{tagName:"button",icon:"history_toggle_off",text:"View queue criteria",intent:"none",onClick:()=>u("queue-criteria")}):null,l&&p?(0,o.jsx)(er.sN,{tagName:"button",icon:"asset_plot",text:"View container metrics",intent:"none",onClick:()=>u("metrics")}):null,i.hasConcurrencyKeySlots&&eu.cv.has(i.status)?(0,o.jsx)(er.sN,{text:"Free concurrency slots",icon:"lock",onClick:w}):null,i.hasDeletePermission?(0,o.jsx)(er.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>u("delete")}):null]}),children:(0,o.jsx)(y.zx,{icon:(0,o.jsx)(f.JO,{name:"expand_more"})})})]}),(0,o.jsx)(ea.U,{isOpen:"config"===a,onClose:()=>u(null),copyConfig:()=>S(),mode:i.mode,runConfigYaml:i.runConfigYaml,tags:i.tags,isJob:r}),i.status===V.VOA.QUEUED?(0,o.jsx)(el.f,{run:i,isOpen:"queue-criteria"===a,onClose:()=>u(null)}):null,l&&p?(0,o.jsx)(p,{runId:i.id,isOpen:"metrics"===a,onClose:()=>u(null)}):null,i.hasDeletePermission?(0,o.jsx)(es.N,{isOpen:"delete"===a,onClose:()=>u(null),onComplete:()=>{i.repositoryOrigin?g.push((0,ef.jT)({repoName:i.repositoryOrigin.repositoryName,repoLocation:i.repositoryOrigin.repositoryLocationName,pipelineName:i.pipelineName,isJob:r,path:"/runs"})):u(null)},onTerminateInstead:()=>u("terminate"),selectedRuns:{[i.id]:i.canTerminate}}):null,i.hasTerminatePermission?(0,o.jsx)(ep.A,{isOpen:"terminate"===a,onClose:()=>u(null),onComplete:()=>{d()},selectedRuns:{[i.id]:i.canTerminate}}):null]})};var eS=t(92322);let ew=()=>{let e=(0,eS.se)("RunRoot");return(0,x.useMemo)(()=>{let n=!1,t=!1;function i(){n&&t&&e.endTrace()}return{onLogsLoaded(){n=!0,i()},onRunLoaded(){t=!0,i()}}},[e])};var eb=t(67994),eC=t(68283),eI=t(71406),eN=t(86269);let eR=e=>{let{loading:n,run:t}=e;return(0,o.jsxs)(o.Fragment,{children:[(null==t?void 0:t.startTime)?(0,o.jsx)(eo.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(l.x,{padding:16,children:(0,o.jsx)(eC.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eN.v,{timestamp:t.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):t.updateTime?(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eN.v,{timestamp:t.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)?(0,o.jsx)(eo.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(l.x,{padding:16,children:(0,o.jsx)(eC.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"timer",children:(0,o.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==t?void 0:t.startTime)?(0,eI.R4)(((null==t?void 0:t.endTime)*1e3||Date.now())-(null==t?void 0:t.startTime)*1e3):"â€“"})})}):null]})};var eT=t(89891),eO=t(53664),ek=t(44030);let eE=e=>{let{instigationSelector:n,instigationType:t,tickId:i}=e,[r,s]=(0,x.useState)(!1),l=t===ec.H.ScheduleName?"schedule":"sensors",{name:a}=n;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.V,{icon:l,children:(0,o.jsxs)("span",{children:["Launched by"," ",(0,o.jsx)(eT.Z,{onClick:()=>s(!0),children:(0,o.jsx)("div",{style:{maxWidth:"140px"},children:(0,o.jsx)(eO.g,{text:a})})})]})}),(0,o.jsx)(ek.X,{isOpen:r,onClose:()=>s(!1),instigationSelector:n,tickId:Number(i)})]})};var e_=t(69737),eL=t(47933),eA=t(75442);let eF=new Intl.Collator(navigator.language,{sensitivity:"base"}),eK=e=>{let{assetKeys:n,evaluationId:t}=e,i=(0,x.useMemo)(()=>[...n].sort((e,n)=>eF.compare(e.path.join("/"),n.path.join("/"))),[n]);return(0,o.jsx)(eo.J,{placement:"bottom",content:(0,o.jsxs)("div",{style:{width:"340px"},children:[(0,o.jsx)(l.x,{padding:{vertical:8,horizontal:12},border:"bottom",style:{fontWeight:600},children:"Auto-materialized"}),(0,o.jsx)(l.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(e=>{let n=(0,eA.p)(e,{view:"automation",evaluation:t});return(0,o.jsxs)(l.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsx)(f.JO,{name:"asset"}),(0,o.jsx)(eO.g,{text:e.path.join("/")})]}),(0,o.jsx)(eL.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,o.jsx)(d.V,{icon:"auto_materialize_policy",children:"Auto-materialized"})})};var ez=t(33847),eD=t(100),eV=t(65822),eU=t(60082);function eJ(){let e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return eJ=function(){return e},e}let eq=()=>{var e;(0,e_.Px)();let n=ew(),{runId:t}=(0,m.UO)();(0,U.j)(t?"Run ".concat(t.slice(0,8)):"Run");let i=(0,r.a)(eM,{variables:{runId:t}}),{data:s,loading:p}=i;(0,Q.Hu)(i,"RunRootQuery");let g=(null==s?void 0:s.pipelineRunOrError.__typename)==="Run"?s.pipelineRunOrError:null,j=null==g?void 0:g.pipelineSnapshotId,y=(0,eU.n)(g),f=(null==y?void 0:y.match)?(0,eV.kQ)(y.match.repository.name,y.match.repositoryLocation.name):null,v=(0,x.useMemo)(()=>!!(g&&y&&(0,eD.E8)(y.match,g.pipelineName)),[g,y]),S=(0,x.useMemo)(()=>(null==g?void 0:g.tags.find(e=>e.key===ec.H.AssetEvaluationID))||null,[g]);(0,x.useLayoutEffect)(()=>{p||n.onRunLoaded()},[p,n]);let w=(0,x.useMemo)(()=>{if(f){let e=(null==g?void 0:g.tags)||[],n=e.find(e=>e.key===ec.H.TickId);if(n){let t=e.find(e=>e.key===ec.H.ScheduleName||e.key===ec.H.SensorName);if(t){let e={name:t.value,repositoryName:f.name,repositoryLocationName:f.location};return{tickId:n.value,instigationType:t.key,instigationSelector:e}}}}return null},[g,f]);return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,o.jsx)(l.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,o.jsx)(a.m,{title:(0,o.jsx)(u.X6,{style:{fontFamily:c.b.monospace,fontSize:"16px"},children:t.slice(0,8)}),tags:g?(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(0,o.jsx)(eb.KG,{status:g.status}),(0,K.pv)(g.pipelineName)?null:(0,o.jsxs)(d.V,{icon:"run",children:["Run of"," ",(0,o.jsx)(ez.h,{pipelineName:null==g?void 0:g.pipelineName,pipelineHrefContext:f||"repo-unknown",snapshotId:j,size:"small",isJob:v})]}),w?(0,o.jsx)(eE,{instigationSelector:w.instigationSelector,instigationType:w.instigationType,tickId:w.tickId}):null,(0,K.pv)(g.pipelineName)?(0,o.jsx)(h.h,{useTags:!0,assetKeys:(0,ed.Bo)(g)}):(0,o.jsx)(X,{run:g}),(0,o.jsx)(h.m,{useTags:!0,assetChecks:g.assetCheckSelection}),(0,o.jsx)(eR,{run:g,loading:p}),S&&(null===(e=g.assetSelection)||void 0===e?void 0:e.length)?(0,o.jsx)(eK,{assetKeys:g.assetSelection,evaluationId:S.value}):null]}):null,right:g?(0,o.jsx)(ev,{run:g,isJob:v}):null})}),(0,o.jsx)(eQ,{data:s,runId:t,trace:n})]})};var eP=eq;let eQ=e=>{let{data:n,runId:t,trace:i}=e;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,o.jsx)(l.x,{padding:{vertical:64},children:(0,o.jsx)(p.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,o.jsx)(H,{run:n.pipelineRunOrError,runId:t,trace:i}):(0,o.jsx)(H,{run:void 0,runId:t,trace:i})},eM=(0,s.Ps)(eJ(),en.tQ)}}]);
//# sourceMappingURL=3917.8b215456cbb9b464.js.map