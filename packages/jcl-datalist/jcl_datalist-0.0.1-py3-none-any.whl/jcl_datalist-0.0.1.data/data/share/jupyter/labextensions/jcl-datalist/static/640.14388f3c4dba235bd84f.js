"use strict";(self.webpackChunkjcl_datalist=self.webpackChunkjcl_datalist||[]).push([[640],{640:(e,t,n)=>{n.r(t),n.d(t,{DaskIcon:()=>V,default:()=>G});var a,s=n(751),r=n(110),i=n(858),o=n(198),l=n(179),c=n(80),d=n(828),u=n(902),h=n(53),p=n(602),m=n(635),g=n(252),v=n(262),f=n(583),b=n(256),k=n(345),C=n(628);class w extends r.MainAreaWidget{constructor(){super({content:new r.IFrame({sandbox:["allow-scripts","allow-same-origin"]})}),this._item=null,this._dashboardUrl="",this._active=!1,this._inactivePanel=a.createInactivePanel(),this.content.node.appendChild(this._inactivePanel),this.addClass("dask-DaskDashboard-widget"),this.update()}get item(){return this._item}set item(e){v.JSONExt.deepEqual(e,this._item)||(this._item=e,this.update())}get dashboardUrl(){return this._dashboardUrl}set dashboardUrl(e){e!==this._dashboardUrl&&(this._dashboardUrl=a.normalizeDashboardUrl(e),this.update())}get active(){return this._active}set active(e){e!==this._active&&(this._active=e,this.update())}onUpdateRequest(){if(!this.item||!this.dashboardUrl||!this.active)return this.content.url="",void(this._inactivePanel.style.display="");this._inactivePanel.style.display="none",this.content.url=m.URLExt.join(this.dashboardUrl,this.item.route)}}class y extends b.Widget{constructor(e){super();let t=this.layout=new b.PanelLayout;this._dashboard=new b.Widget,this._serverSettings=g.ServerConnection.makeSettings(),this._input=new _(this._serverSettings,e.linkFinder),t.addWidget(this._input),t.addWidget(this._dashboard),this.addClass("dask-DaskDashboardLauncher"),this._items=e.items||[],this._launchItem=e.launchItem,this._input.urlInfoChanged.connect(this._updateLinks,this)}_updateLinks(e,t){if(!t.newValue.isActive)return void this.update();const n=a.getDashboardPlots(t.newValue);this._items=n,this.update()}get items(){return this._items}get input(){return this._input}onUpdateRequest(){this.isVisible&&C.render(k.createElement(x,{launchItem:this._launchItem,isEnabled:this.input.urlInfo.isActive,items:this._items}),this._dashboard.node)}onAfterShow(){this.update()}}class _ extends b.Widget{constructor(e,t){super(),this._urlChanged=new p.Signal(this),this._urlInfo={isActive:!1,url:"",plots:{}},this._browserDashboardCheck=!1;const n=this.layout=new b.PanelLayout,a=new b.Widget;n.addWidget(a),this._serverSettings=e,this._startUrlCheckTimer()}get input(){return this._input}set url(e){this._input.value=e;const t=this._urlInfo;e!==t.url&&a.testDaskDashboard(e,this._serverSettings,this._browserDashboardCheck).then((n=>{this._urlInfo=n,this._urlChanged.emit({oldValue:t,newValue:n}),this._input.blur(),this.update(),n||console.warn(`${e} does not appear to host a valid Dask dashboard`)}))}get urlInfo(){return this._urlInfo}get urlInfoChanged(){return this._urlChanged}get browserDashboardCheck(){return this._browserDashboardCheck}set browserDashboardCheck(e){this._browserDashboardCheck=e}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}handleEvent(e){"keydown"===e.type&&13===e.keyCode&&(e.stopPropagation(),e.preventDefault(),this.url=this._input.value)}onAfterAttach(){this._input.addEventListener("keydown",this,!0)}onBeforeDetach(){this._input.removeEventListener("keydown",this,!0)}_startUrlCheckTimer(){this._poll=new f.Poll({factory:async()=>{const e=this._urlInfo;if(!e.url)return;const t=await a.testDaskDashboard(e.url,this._serverSettings,this._browserDashboardCheck);if(!t.isActive&&e.isActive&&console.warn(`The connection to dask dashboard ${e.url} has been lost`),v.JSONExt.deepEqual(t,e)||(this._urlInfo=t,this._urlChanged.emit({oldValue:e,newValue:t})),!t.isActive)throw Error(`No connection to ${e.url}`)},frequency:{interval:4e3,backoff:!0,max:12e4},standby:"when-hidden"}),this._urlChanged.connect((()=>this._poll.refresh()),this)}}function x(e){if(!e.isEnabled)return k.createElement("div",{className:"dask-DashboardListing-inactive"},"code代码");const t=[...e.items].sort(((e,t)=>e.label<=t.label?-1:1)).map((t=>k.createElement("li",{className:"dask-DashboardListing-item",key:t.route},k.createElement("button",{className:"jp-mod-styled jp-mod-accept",value:t.label,disabled:!e.isEnabled,onClick:()=>e.launchItem(t)},t.label))));return k.createElement("div",null,k.createElement("ul",{className:"dask-DashboardListing-list"},t))}!function(e){function t(e,t=""){if(n(e)){t||(t=m.PageConfig.getBaseUrl());const n=new URL(t);e.startsWith(n.pathname)&&(e=e.slice(n.pathname.length)),e=t+e}return e.endsWith("status")?e=e.slice(0,-6):e.endsWith("status/")&&(e=e.slice(0,-7)),e}function n(e){const{protocol:t}=m.URLExt.parse(e);return 0!==e.toLowerCase().indexOf(t)&&0!==e.indexOf("//")}e.normalizeDashboardUrl=t,e.getDashboardPlots=function(e){const t=[];for(let n in e.plots){const a=n.replace("Individual ",""),s={route:String(e.plots[n]),label:a,key:a};t.push(s)}return t},e.testDaskDashboard=async function(e,n,a=!1){if(0===(e=t(e,n.baseUrl)).indexOf(n.baseUrl))return g.ServerConnection.makeRequest(m.URLExt.join(e,"individual-plots.json"),{},n).then((async t=>{if(200===t.status){const n=await t.json();return{url:e,isActive:!0,plots:n}}return{url:e,isActive:!1,plots:{}}})).catch((()=>({url:e,isActive:!1,plots:{}})));if(a)return fetch(m.URLExt.join(e,"individual-plots.json")).then((async t=>{if(200===t.status){const n=await t.json();return{url:e,isActive:!0,plots:n}}return{url:e,isActive:!1,plots:{}}})).catch((()=>({url:e,isActive:!1,plots:{}})));const s=await g.ServerConnection.makeRequest(m.URLExt.join(n.baseUrl,"dask","dashboard-check",encodeURIComponent(e)),{},n);return await s.json()},e.createInactivePanel=function(){const e=document.createElement("div");return e.className="dask-DaskDashboard-inactive",e},e.isLocal=n}(a||(a={}));var L,j=n(209),I=n(355);class S extends k.Component{constructor(e){let t;super(e);const n=!!e.initialModel.adapt;t=n?e.initialModel:{...e.initialModel,adapt:{minimum:e.initialModel.workers,maximum:e.initialModel.workers}},this.state={adaptive:n,model:t}}componentDidUpdate(){let e={...this.state.model};this.state.adaptive||(e.adapt=null),this.props.stateEscapeHatch(e)}onScaleChanged(e){this.setState({model:{...this.state.model,workers:parseInt(e.target.value,10)}})}onScalingChanged(e){const t=e.target.checked;this.setState({model:this.state.model,adaptive:t})}onMinimumChanged(e){const t=parseInt(e.target.value,10),n=Math.max(0,t),a=Math.max(this.state.model.adapt.maximum,n);this.setState({model:{...this.state.model,adapt:{maximum:a,minimum:n}}})}onMaximumChanged(e){const t=parseInt(e.target.value,10),n=Math.max(0,t),a=Math.min(this.state.model.adapt.minimum,n);this.setState({model:{...this.state.model,adapt:{maximum:n,minimum:a}}})}render(){const e=this.state.model,t=e.adapt,n=this.state.adaptive,a="dask-mod-disabled";return k.createElement("div",null,k.createElement("span",{className:"dask-ScalingHeader"},"Manual Scaling"),k.createElement("div",{className:"dask-ScalingSection"},k.createElement("div",{className:"dask-ScalingSection-item"},k.createElement("span",{className:`dask-ScalingSection-label ${n?a:""}`},"Workers"),k.createElement("input",{className:"dask-ScalingInput",disabled:n,value:e.workers,type:"number",step:"1",onChange:e=>{this.onScaleChanged(e)}}))),k.createElement("div",{className:"dask-ScalingHeader"},"Adaptive Scaling",k.createElement("input",{className:"dask-ScalingCheckbox",type:"checkbox",checked:n,onChange:e=>{this.onScalingChanged(e)}})),k.createElement("div",{className:"dask-ScalingSection"},k.createElement("div",{className:"dask-ScalingSection-item"},k.createElement("span",{className:`dask-ScalingSection-label ${n?"":a}`},"Minimum workers"),k.createElement("input",{className:"dask-ScalingInput",disabled:!n,type:"number",value:t.minimum,step:"1",onChange:e=>{this.onMinimumChanged(e)}}))),k.createElement("div",{className:"dask-ScalingSection"},k.createElement("div",{className:"dask-ScalingSection-item"},k.createElement("span",{className:`dask-ScalingSection-label ${n?"":a}`},"Maximum workers"),k.createElement("input",{className:"dask-ScalingInput",disabled:!n,type:"number",value:t.maximum,step:"1",onChange:e=>{this.onMaximumChanged(e)}}))))}}class D extends b.Widget{constructor(e){super(),this._dragData=null,this._clusters=[],this._activeClusterChanged=new p.Signal(this),this._failedServerChecks=0,this._hasServer=!1,this._isReady=!0,this._serverSettings=g.ServerConnection.makeSettings(),this._getClientCodeForCluster=e.getClientCodeForCluster,this._registry=e.registry,this._launchClusterId=e.launchClusterId,this._setActiveById=t=>{const n=this._clusters.find((e=>e.id===t));if(!n)return;const a=m.URLExt.join(this._serverSettings.baseUrl,"proxy"),s=new URL(a).pathname;-1!==n.dashboard_link.indexOf(s)?e.setDashboardUrl(n.dashboard_link):e.setDashboardUrl(`dask/dashboard/${n.id}`);const r=this._activeCluster;r&&r.id===n.id||(this._activeCluster=n,this._activeClusterChanged.emit({name:"cluster",oldValue:r,newValue:n}),this.update())};const t=this.layout=new b.PanelLayout;this._clusterListing=new b.Widget,this._clusterListing.addClass("dask-ClusterListing");const n=new r.Toolbar;n.addItem(this._launchClusterId,new r.CommandToolbarButton({commands:this._registry,id:this._launchClusterId})),t.addWidget(n),t.addWidget(this._clusterListing),this._updateClusterList(),this._poll=new f.Poll({factory:async()=>{await this._updateClusterList()},frequency:{interval:5e3,backoff:!0,max:6e4},standby:"when-hidden"})}get activeCluster(){return this._activeCluster}setActiveCluster(e){this._setActiveById(e)}get activeClusterChanged(){return this._activeClusterChanged}get isReady(){return this._isReady}get clusters(){return this._clusters}async refresh(){await this._updateClusterList()}async start(){return await this._launchCluster()}async stop(e){if(!this._clusters.find((t=>t.id===e)))throw Error(`Cannot find cluster ${e}`)}async scale(e){if(!this._clusters.find((t=>t.id===e)))throw Error(`Cannot find cluster ${e}`);return await this._scaleById(e)}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}onUpdateRequest(e){}onAfterShow(e){this.update()}onAfterAttach(e){super.onAfterAttach(e);let t=this._clusterListing.node;t.addEventListener("p-dragenter",this),t.addEventListener("p-dragleave",this),t.addEventListener("p-dragover",this),t.addEventListener("mousedown",this)}onBeforeDetach(e){let t=this._clusterListing.node;t.removeEventListener("p-dragenter",this),t.removeEventListener("p-dragleave",this),t.removeEventListener("p-dragover",this),t.removeEventListener("mousedown",this),document.removeEventListener("mouseup",this,!0),document.removeEventListener("mousemove",this,!0)}handleEvent(e){switch(e.type){case"mousedown":this._evtMouseDown(e);break;case"mouseup":this._evtMouseUp(e);break;case"mousemove":this._evtMouseMove(e)}}_evtMouseDown(e){const{button:t,shiftKey:n}=e;if(0!==t&&2!==t)return;if(n&&2===t)return;const a=this._findCluster(e);-1!==a&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:a},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault())}_evtMouseUp(e){0===e.button&&this._drag||(document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)),e.preventDefault(),e.stopPropagation()}_evtMouseMove(e){let t=this._dragData;if(!t)return;let n=Math.abs(e.clientX-t.pressX),a=Math.abs(e.clientY-t.pressY);(n>=5||a>=5)&&(e.preventDefault(),e.stopPropagation(),this._startDrag(t.index,e.clientX,e.clientY))}async _startDrag(e,t,n){const a=this._clusters[e],s=this._clusterListing.node.querySelector(`li.dask-ClusterListingItem[data-cluster-id="${a.id}"]`),r=L.createDragImage(s);this._drag=new I.Drag({mimeData:new v.MimeData,dragImage:r,supportedActions:"copy",proposedAction:"copy",source:this});const i=this._getClientCodeForCluster(a);this._drag.mimeData.setData("text/plain",i);const o=[{cell_type:"code",source:i,outputs:[],execution_count:null,metadata:{}}];return this._drag.mimeData.setData("application/vnd.jupyter.cells",o),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._drag.start(t,n).then((e=>{this.isDisposed||(this._drag=null,this._dragData=null)}))}async _launchCluster(){this._isReady=!1,this._registry.notifyCommandChanged(this._launchClusterId);const e=await g.ServerConnection.makeRequest(`${this._serverSettings.baseUrl}dask/clusters`,{method:"PUT"},this._serverSettings);if(200!==e.status){const t=await e.json();throw(0,r.showErrorMessage)("Cluster Start Error",t),this._isReady=!0,this._registry.notifyCommandChanged(this._launchClusterId),t}const t=await e.json();return await this._updateClusterList(),this._isReady=!0,this._registry.notifyCommandChanged(this._launchClusterId),t}async _updateClusterList(){const e=await g.ServerConnection.makeRequest(`${this._serverSettings.baseUrl}dask/clusters`,{},this._serverSettings);if(200!==e.status){this._failedServerChecks++;const e=new Error("Failed to list Dask clusters: might the server extension not be installed/enabled?");throw this._hasServer||5!=this._failedServerChecks||(0,r.showErrorMessage)("Dask Server Error",e),e}this._hasServer=!0;const t=await e.json();if(this._clusters=t,!this._clusters.find((e=>e.id===(this._activeCluster&&this._activeCluster.id)))){const e=this._clusters[0]&&this._clusters[0].id||"";this._setActiveById(e)}this.update()}async _scaleById(e){const t=this._clusters.find((t=>t.id===e));if(!t)throw Error(`Failed to find cluster ${e} to scale`);const n=await function(e){let t={...e};return(0,r.showDialog)({title:`Scale ${e.name}`,body:k.createElement(S,{initialModel:e,stateEscapeHatch:e=>{t=e}}),buttons:[r.Dialog.cancelButton(),r.Dialog.okButton({label:"SCALE"})]}).then((n=>n.button.accept?t:e))}(t);if(v.JSONExt.deepEqual(n,t))return Promise.resolve(t);const a=await g.ServerConnection.makeRequest(`${this._serverSettings.baseUrl}dask/clusters/${e}`,{method:"PATCH",body:JSON.stringify(n)},this._serverSettings);if(200!==a.status){const e=await a.json();throw(0,r.showErrorMessage)("Failed to scale cluster",e),e}return await a.json()}_findCluster(e){const t=Array.from(this.node.querySelectorAll("li.dask-ClusterListingItem"));return h.ArrayExt.findFirstIndex(t,(t=>j.ElementExt.hitTest(t,e.clientX,e.clientY)))}}!function(e){e.createDragImage=function(e){const t=e.cloneNode(!0);return t.classList.add("dask-ClusterListingItem-drag"),t}}(L||(L={}));class E extends b.Widget{constructor(e){super(),this.addClass("dask-DaskSidebar");let t=this.layout=new b.PanelLayout;this._dashboard=new y({launchItem:e.launchDashboardItem,linkFinder:e.linkFinder});const n=e.clientCodeInjector,a=e.clientCodeGetter;this._clusters=new D({registry:e.registry,launchClusterId:e.launchClusterId,setDashboardUrl:e=>{this._dashboard.input.url=e},injectClientCodeForCluster:n,getClientCodeForCluster:a}),t.addWidget(this._dashboard),t.addWidget(this._clusters)}get dashboardLauncher(){return this._dashboard}get clusterManager(){return this._clusters}}var M=n(72),U=n.n(M),A=n(825),R=n.n(A),P=n(659),N=n.n(P),z=n(56),W=n.n(z),$=n(540),T=n.n($),F=n(113),B=n.n(F),q=n(646),H={};H.styleTagTransform=B(),H.setAttributes=W(),H.insert=N().bind(null,"head"),H.domAPI=R(),H.insertStyleElement=T(),U()(q.A,H),q.A&&q.A.locals&&q.A.locals;const V=new i.LabIcon({name:"jcldata:icon",svgstr:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1720489319724" class="icon" viewBox="0 0 1210 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3584" xmlns:xlink="http://www.w3.org/1999/xlink" width="236.328125" height="200"><path d="M1166.576941 930.936471a43.610353 43.610353 0 0 1 43.610353 43.610353v6.023529a43.610353 43.610353 0 0 1-43.610353 43.610353H43.610353A43.610353 43.610353 0 0 1 0 980.570353v-6.023529a43.610353 43.610353 0 0 1 43.610353-43.610353zM328.764235 279.250824a43.610353 43.610353 0 0 1 43.610353 43.610352v518.02353a43.610353 43.610353 0 0 1-43.610353 43.610353H136.734118a43.610353 43.610353 0 0 1-43.610353-43.610353v-518.02353a43.610353 43.610353 0 0 1 43.610353-43.610352z m744.688941 139.625411a43.610353 43.610353 0 0 1 43.610353 43.610353v378.217412a43.610353 43.610353 0 0 1-43.610353 43.610353h-192.030117a43.610353 43.610353 0 0 1-43.610353-43.610353V462.486588a43.610353 43.610353 0 0 1 43.610353-43.610353zM701.379765 0a43.610353 43.610353 0 0 1 43.610353 43.610353v797.093647a43.610353 43.610353 0 0 1-43.610353 43.610353H509.108706a43.610353 43.610353 0 0 1-43.610353-43.610353V43.610353A43.610353 43.610353 0 0 1 509.108706 0z" fill="#1D85ED" p-id="3585"></path></svg>'});var O;!function(e){e.launchPanel="jcl:launch-dashboard",e.launchLayout="jcl:launch-layout",e.populateDashboardUrl="jcl:populate-dashboard-url",e.populateAndLaunchLayout="jcl:populate-and-launch-layout",e.injectClientCode="jcl:inject-client-code",e.launchCluster="jcl:launch-cluster",e.stopCluster="jcl:stop-cluster",e.scaleCluster="jcl:scale-cluster",e.toggleAutoStartClient="jcl:toggle-auto-start-client"}(O||(O={}));const K="jcl-labextension:plugin",Y={activate:async function(e,t,n,a,s,i,o,l,c){const d="jcldata-dashboard-launcher",u=async()=>{const e=X.getCurrentKernel(a,o,n);return await X.shouldUseKernel(e)?await X.checkKernel(e):""},m=async t=>{const a=await X.getCurrentEditor(e,o,n);a&&X.injectClientCode(t,a)},g=new E({launchDashboardItem:t=>{e.commands.execute(O.launchPanel,{item:t})},linkFinder:u,clientCodeInjector:m,clientCodeGetter:X.getClientCode,registry:e.commands,launchClusterId:O.launchCluster});g.id=d,g.title.icon=V,g.title.iconClass="jp-SideBar-tabIcon",g.title.caption="数据集";const v=new r.WidgetTracker({namespace:"jcl-dashboard-launcher"});s.add(g,d),s.restore(v,{command:O.launchPanel,args:e=>({item:e.item}||{}),name:e=>e.item&&e.item.route||""}),a.add(g,"left",{rank:200});const f=()=>{const e=g.dashboardLauncher.input,t=g.dashboardLauncher.items;v.forEach((n=>{const a=t.find((e=>{var t;return(null===(t=n.item)||void 0===t?void 0:t.route)===e.route}));if(!a||!e.urlInfo.isActive)return n.active=!1,void(n.dashboardUrl="");`${a.label}`!==n.title.label&&(n.title.label=`${a.label}`),n.dashboardUrl=e.urlInfo.effectiveUrl||e.urlInfo.url,n.active=!0}))};g.dashboardLauncher.input.urlInfoChanged.connect((async(e,t)=>{f();const n=g.clusterManager.activeCluster;return c.save(d,{url:t.newValue.url,cluster:n?n.id:""})})),g.clusterManager.activeClusterChanged.connect((async()=>{const e=g.clusterManager.activeCluster;return c.save(d,{url:g.dashboardLauncher.input.urlInfo.url,cluster:e?e.id:""})})),f();const b=async e=>{if(!e)return;const t=g.clusterManager.activeCluster;return t&&await X.shouldUseKernel(e.kernel)?X.createClientForKernel(t,e.kernel):void 0},k=[o,n],C=async e=>{e.session&&e.session.kernel&&e.session.kernel.status},y=(e,t)=>{t.sessionContext.statusChanged.connect(C)},_=()=>{k.forEach((e=>{e.forEach((async e=>{const t=e.sessionContext.session;if(t&&await X.shouldUseKernel(t.kernel))return b(t)}))}))};let x,L=!1,j=!1,I=!1;Promise.all([l.load(K),c.fetch(d)]).then((async e=>{const t=e[0];if(!t)return void console.warn("Unable to retrieve jcl-labextension settings");const n=e[1],a=n?n.url:"",s=n?n.cluster:"",r=g.dashboardLauncher.input.urlInfo.effectiveUrl||g.dashboardLauncher.input.urlInfo.url;g.dashboardLauncher.input.url=a&&!r?a:t.get("defaultURL").composite;const i=()=>{L=t.get("autoStartClient").composite,p.Signal.clearData(y),p.Signal.clearData(C),p.Signal.clearData(_),L&&(k.forEach((e=>{e.widgetAdded.connect(y)})),k.forEach((e=>{e.forEach((async e=>{await b(e.sessionContext.session),e.sessionContext.statusChanged.connect(C)}))})),g.clusterManager.activeClusterChanged.connect(_)),I=t.get("browserDashboardCheck").composite,g.dashboardLauncher.input.browserDashboardCheck=I,j=t.get("hideClusterManager").composite,g.clusterManager.setHidden(j),x=t.get("defaultLayout").composite};i(),t.changed.connect(i),s&&(await g.clusterManager.refresh(),g.clusterManager.setActiveCluster(s))})),e.commands.addCommand(O.launchPanel,{label:e=>`Launch jcl ${e.item.label||""} Dashboard`,caption:"Launch a jcl dashboard",execute:e=>{const t=g.dashboardLauncher.input.urlInfo,n=t.effectiveUrl||t.url,s=t.isActive,r=e.item,i=null==e?void 0:e.options,o=v.find((e=>!(!e||!e.item||e.item.route!==r.route)));if(o)return o.isAttached||a.add(o,"main",i),void a.activateById(o.id);const l=new w;return l.dashboardUrl=n,l.item=r,l.active=s,l.id="jcl-dashboard-"+X.id++,l.title.label=`${r.label}`,l.title.icon=V,a.add(l,"main",i),v.add(l),l}});const S=e=>(e.startsWith("/")&&(e=e.slice(1)),e.startsWith("individual-")||(e="individual-"+e),e);e.commands.addCommand(O.launchLayout,{label:"Launch jcl Dashboard Layout",caption:"Launch a pre-configured jcl Dashboard Layout",isEnabled:()=>g.dashboardLauncher.input.urlInfo.isActive,execute:async()=>{const t=g.dashboardLauncher.items,n=[];for(let e of Object.keys(x))n.push([x[e].ref||null,e]);const a=(0,h.topologicSort)(n).filter((e=>e)),s=e.shell.currentWidget;for(let n of a){const a=x[n],s=t.find((e=>S(e.route)===S(n)));if(!s){console.warn(`Non-existent dashboard found in jcl layout spec ${n}`);continue}const r={mode:a.mode};if(a.ref){const e=v.find((e=>!(!e||!e.item||S(e.item.route)!==S(a.ref))));e?r.ref=e.id:(console.warn(`Non-existent dashboard found in Dask layout spec ${a.ref}`),r.ref=null)}else r.ref=null;await e.commands.execute(O.launchPanel,{item:s,options:r})}e.shell.activateById(s.id)}}),e.commands.addCommand(O.populateDashboardUrl,{label:"Populate jcl Dashboard URL",caption:"Attempt to populate the URL for an active jcl cluster",execute:async e=>{let t=e.url||await u();return t&&(g.dashboardLauncher.input.url=t),t}}),e.commands.addCommand(O.populateAndLaunchLayout,{label:"Populate jcl Dashboard URL and launch the default layout",caption:"Attempt to populate the URL for an active jcl cluster and then launch the default layout",execute:async t=>{await e.commands.execute(O.populateDashboardUrl,t)&&await e.commands.execute(O.launchLayout)}}),e.commands.addCommand(O.injectClientCode,{label:"Inject jcl Client Connection Code",execute:async()=>{const t=X.clusterFromClick(e,g.clusterManager);t&&await m(t)}}),e.commands.addCommand(O.stopCluster,{label:"Shutdown Cluster",execute:()=>{const t=X.clusterFromClick(e,g.clusterManager);if(t)return g.clusterManager.stop(t.id)}}),e.commands.addCommand(O.scaleCluster,{label:"Scale Cluster…",execute:()=>{const t=X.clusterFromClick(e,g.clusterManager);if(t)return g.clusterManager.scale(t.id)}}),e.commands.addCommand(O.toggleAutoStartClient,{label:"Auto-Start jcl",isToggled:()=>L,execute:async()=>{const e=!L,t="autoStartClient";return l.set(K,t,e).catch((e=>{console.error(`Failed to set ${K}:${t} - ${e.message}`)}))}}),i.fileMenu.addGroup([{command:O.launchLayout}],50),i.settingsMenu.addGroup([{command:O.toggleAutoStartClient}]),[O.launchCluster,O.launchLayout,O.toggleAutoStartClient].forEach((e=>{t.addItem({category:"jcl",command:e,args:{isPalette:!0}})})),e.contextMenu.addItem({command:O.injectClientCode,selector:".jcl-ClusterListingItem",rank:10}),e.contextMenu.addItem({command:O.stopCluster,selector:".jcl-ClusterListingItem",rank:3}),e.contextMenu.addItem({command:O.scaleCluster,selector:".jcl-ClusterListingItem",rank:2}),e.contextMenu.addItem({command:O.launchCluster,selector:".jcl-ClusterListing-list",rank:1})},id:K,requires:[r.ICommandPalette,o.IConsoleTracker,s.ILabShell,s.ILayoutRestorer,l.IMainMenu,u.INotebookTracker,c.ISettingRegistry,d.IStateDB],autoStart:!0},G=Y;var X;!function(e){function t(e){return`from dask.distributed import Client\n\nclient = Client("${e.scheduler_address}")\nclient`}async function n(e){return await e.ready,e&&e.editor}e.id=0,e.shouldUseKernel=async function(e){if(!e)return!1;const t=await e.spec;return!!t&&-1!==t.language.toLowerCase().indexOf("python")},e.checkKernel=function(e){const t={store_history:!1,code:"try:\n  from dask.distributed import default_client as _internal_jlab_default_client\n  display(_internal_jlab_default_client().dashboard_link)\nexcept:\n  pass"};return new Promise(((n,a)=>{e.requestExecute(t).onIOPub=e=>{if("display_data"!==e.header.msg_type)return;const t=e.content.data["text/plain"]||"";console.log(`Found dashboard link at ${t}`),n(t.replace(/'/g,"").split("status")[0])}}))},e.createClientForKernel=async function(e,t){const n={store_history:!1,code:`import dask; from dask.distributed import Client\ndask.config.set({'scheduler-address': '${e.scheduler_address}'})\nclient = Client()`};return new Promise(((e,a)=>{t.requestExecute(n).onIOPub=t=>{"display_data"===t.header.msg_type&&e(void 0)}}))},e.injectClientCode=function(e,n){const a=t(e);n.model.sharedModel.setSource(a)},e.getClientCode=t,e.getCurrentKernel=function(e,t,n){var a,s,r,i;let o,l=e.currentWidget;return l&&t.has(l)?o=null===(a=l.sessionContext.session)||void 0===a?void 0:a.kernel:l&&n.has(l)?o=null===(s=l.sessionContext.session)||void 0===s?void 0:s.kernel:t.currentWidget?o=null===(r=t.currentWidget.sessionContext.session)||void 0===r?void 0:r.kernel:n.currentWidget&&(o=null===(i=n.currentWidget.sessionContext.session)||void 0===i?void 0:i.kernel),o},e.getEditor=n,e.getCurrentEditor=async function(e,t,a){let s=e.shell.currentWidget;if(s&&t.has(s))return u.NotebookActions.insertAbove(s.content),n(s.content.activeCell);if(s&&a.has(s))return n(s.console.promptCell);if(t.currentWidget){const e=t.currentWidget;return u.NotebookActions.insertAbove(e.content),n(e.content.activeCell)}return a.currentWidget?n(a.currentWidget.console.promptCell):void 0},e.clusterFromClick=function(e,t){const n=e.contextMenuHitTest((e=>!!e.dataset.clusterId));if(!n)return;const a=n.dataset.clusterId;return t.clusters.find((e=>e.id===a))}}(X||(X={}))},646:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(601),s=n.n(a),r=n(314),i=n.n(r),o=n(417),l=n.n(o),c=new URL(n(908),n.b),d=new URL(n(764),n.b),u=i()(s()),h=l()(c),p=l()(d);u.push([e.id,`:root {\n  --dask-launch-button-height: 24px;\n}\n\n/**\n * Rules related to the overall sidebar panel.\n */\n\n.dask-DaskSidebar {\n  background: var(--jp-layout-color1);\n  color: var(--jp-ui-font-color1);\n  font-size: var(--jp-ui-font-size1);\n  overflow: auto;\n}\n\n/**\n * Rules related to the dashboard launcher.\n */\n\n.dask-DashboardListing-inactive {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  height: 100px;\n  color: var(--jp-ui-font-color3);\n}\n\n.dask-DashboardListing-inactive-title {\n  font-size: var(--jp-ui-font-size3);\n  padding: 24px;\n  text-align: center;\n}\n\n.dask-DashboardListing-inactive-detail {\n  font-size: var(--jp-ui-font-size4);\n  padding: 24px;\n}\n\n.dask-DashboardListing-inactive:before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 80%;\n  height: 80%;\n  /* background-image: url(dask.svg);\n  background-repeat: no-repeat;\n  background-position: center;\n  opacity: 0.1; */\n}\n\n.dask-DashboardListing-list {\n  margin: 8px;\n  padding: 0;\n  list-style-type: none;\n}\n\n.dask-DashboardListing-item {\n  margin-top: 4px;\n  margin-bottom: 4px;\n  margin-left: 12px;\n  margin-right: 12px;\n  white-space: nowrap;\n}\n\n.dask-DashboardListing-item button {\n  font-size: var(--jp-ui-font-size0);\n  border-radius: 2px;\n  line-height: 1em;\n  padding: 0px 8px;\n  width: 100%;\n}\n\n.dask-DashboardListing-item button.jp-mod-styled.jp-mod-accept {\n  height: var(--dask-launch-button-height);\n  color: #262326;\n  background-color: #ffc11e;\n  border: 1px solid #ffc11e;\n  text-transform: uppercase;\n}\n\n.dask-URLInput {\n  padding: 8px;\n  display: flex;\n  align-items: center;\n  background-color: var(--jp-layout-color1);\n  border-bottom: 1px solid var(--jp-border-color2);\n  box-shadow: var(--jp-toolbar-box-shadow);\n  z-index: 2;\n}\n\n.dask-URLInput-wrapper {\n  background-color: var(--jp-input-active-background);\n  border: var(--jp-border-width) solid var(--jp-border-color2);\n  flex: 1 1 auto;\n  height: 30px;\n  padding: 0px 12px;\n  margin: 0 4px 0 0;\n}\n\n.dask-URLInput-wrapper:focus-within {\n  border: var(--jp-border-width) solid var(--md-blue-500);\n  box-shadow: inset 0 0 4px var(--md-blue-300);\n}\n\n.dask-URLInput-wrapper input {\n  background: transparent;\n  float: left;\n  border: none;\n  outline: none;\n  font-size: var(--jp-ui-font-size1);\n  color: var(--jp-ui-font-color0);\n  width: calc(100% - 18px);\n  line-height: 28px;\n}\n\n.dask-URLInput-wrapper::placeholder {\n  color: var(--jp-ui-font-color3);\n  font-size: var(--jp-ui-font-size1);\n}\n\n.dask-UrlInput .jp-ToolbarButton {\n  flex: 0 0 auto;\n  margin: 0 0 0 4px;\n  background-color: var(--jp-layout-color2);\n  min-width: 16px;\n}\n\n/**\n * Rules for the dashboard panels.\n */\n.dask-DaskDashboard-widget {\n  background-color: white;\n}\n\n.dask-DaskDashboard-inactive {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--jp-ui-font-color3);\n  font-size: var(--jp-ui-font-size3);\n  background-color: var(--jp-layout-color0);\n  z-index: 10;\n}\n\n.dask-DaskDashboard-inactive:before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  /* background-image: url(dask.svg);\n  background-repeat: no-repeat;\n  background-position: center;\n  opacity: 0.1; */\n}\n\n/**\n * Rules related to the cluster manager.\n */\n\n.dask-DaskClusterManager {\n  border-top: 6px solid var(--jp-toolbar-border-color);\n}\n\n.dask-DaskClusterManager .jp-Toolbar {\n  align-items: center;\n}\n.dask-DaskDashboardLauncher {\n  width: 100%;\n  height: 100%;\n}\n.dask-DaskClusterManager .jp-Toolbar .dask-DaskClusterManager-label {\n  flex: 0 0 auto;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  font-size: var(--jp-ui-font-size0);\n  padding: 8px 8px 8px 12px;\n  margin: 0px;\n}\n\n.dask-DaskClusterManager button.jp-Button > span {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.dask-ClusterListing ul.dask-ClusterListing-list {\n  list-style-type: none;\n  padding: 0;\n  margin: 0;\n}\n\n.dask-ClusterListingItem {\n  display: inline-block;\n  list-style-type: none;\n  padding: 8px;\n  width: 100%;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  cursor: grab;\n}\n\n.dask-ClusterListingItem-drag {\n  opacity: 0.7;\n  color: var(--jp-ui-font-color1);\n  cursor: grabbing;\n  max-width: 260px;\n  transform: translateX(-50%) translateY(-50%);\n}\n\n.dask-ClusterListingItem-title {\n  margin: 0px;\n  font-size: var(--jp-ui-font-size2);\n}\n\n.dask-ClusterListingItem-link a {\n  text-decoration: none;\n  color: var(--jp-content-link-color);\n}\n\n.dask-ClusterListingItem-link a:hover {\n  text-decoration: underline;\n}\n\n.dask-ClusterListingItem-link a:visited {\n  color: var(--jp-content-link-color);\n}\n\n.dask-ClusterListingItem:hover {\n  background: var(--jp-layout-color2);\n}\n\n.dask-ClusterListingItem.jp-mod-active {\n  color: white;\n  background: var(--jp-brand-color0);\n}\n\n.dask-ClusterListingItem.jp-mod-active a,\n.dask-ClusterListingItem.jp-mod-active a:visited {\n  color: white;\n}\n\n.dask-ClusterListingItem button.jp-mod-styled {\n  background-color: transparent;\n}\n\n.dask-ClusterListingItem button.jp-mod-styled:hover {\n  background-color: var(--jp-layout-color3);\n}\n\n.dask-ClusterListingItem.jp-mod-active button.jp-mod-styled:hover {\n  background-color: var(--jp-brand-color1);\n}\n\n.dask-ClusterListingItem-button-panel {\n  display: flex;\n  align-content: center;\n}\n\nbutton.dask-ClusterListingItem-stop {\n  color: var(--jp-warn-color1);\n  font-weight: 600;\n}\n\nbutton.dask-ClusterListingItem-scale {\n  color: var(--jp-accent-color1);\n  font-weight: 600;\n}\n\n.dask-ClusterListingItem button.dask-ClusterListingItem-code.jp-mod-styled {\n  margin: 0 4px 0 4px;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n\n/**\n * Rules for the scaling dialog.\n */\n\n.dask-ScalingHeader {\n  font-size: var(--jp-ui-font-size2);\n}\n\n.dask-ScalingSection {\n  margin-left: 24px;\n}\n\n.dask-ScalingSection-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n  margin: 12px 0 12px 0;\n}\n\n.dask-ScalingHeader input[type='checkbox'] {\n  position: relative;\n  top: 4px;\n  left: 4px;\n  margin: 0 0 0 8px;\n}\n\n.dask-ScalingSection input[type='number'] {\n  width: 72px;\n}\n\n.dask-ScalingSection-label.dask-mod-disabled {\n  color: var(--jp-ui-font-color3);\n}\n\n.dask-ScalingSection input[type='number']:disabled {\n  color: var(--jp-ui-font-color3);\n}\n\n/**\n * Rules for the logos.\n */\n\n.dask-SearchIcon {\n  background-image: var(--jp-icon-search);\n}\n\n[data-jp-theme-light='true'] .dask-CodeIcon {\n  background-image: url(${h});\n}\n\n[data-jp-theme-light='false'] .dask-CodeIcon {\n  background-image: url(${p});\n}\n\n.dask-ClusterListingItem.jp-mod-active .dask-CodeIcon {\n  background-image: url(${p});\n}\n\n.dask-DaskLogo {\n  /* background-image: url(dask.svg); */\n}\n\n#setting-editor .dask-DaskLogo {\n  background-repeat: no-repeat;\n  background-size: 85%;\n  background-position: center;\n}\n`,""]);const m=u},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,s,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},i=[],o=0;o<e.length;o++){var l=e[o],c=a.base?l[0]+a.base:l[0],d=r[c]||0,u="".concat(c," ").concat(d);r[c]=d+1;var h=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var m=s(p,a);a.byIndex=o,t.splice(o,0,{identifier:u,updater:m,references:1})}i.push(u)}return i}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var r=a(e=e||[],s=s||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var o=n(r[i]);t[o].references--}for(var l=a(e,s),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,s&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},764:e=>{e.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23E0E0E0' width='24' height='24' viewBox='0 0 24 24'%3e%3cpath fill='none' d='M0 0h24v24H0V0z'/%3e%3cpath d='M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z'/%3e%3c/svg%3e"},908:e=>{e.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23616161' width='24' height='24' viewBox='0 0 24 24'%3e%3cpath fill='none' d='M0 0h24v24H0V0z'/%3e%3cpath d='M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z'/%3e%3c/svg%3e"}}]);